<!--
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed
under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.
--><!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1.5.13. /db/_design/design-doc/_rewrite/path &mdash; Apache CouchDB® 3.3 Documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/rtd_theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="canonical" href="https://docs.couchdb.org/en/stable/api/ddoc/rewrites.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.6. Partitioned Databases" href="../partitioned-dbs.html" />
    <link rel="prev" title="1.5.7. /db/_design/design-doc/_show/show-name" href="render.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Apache CouchDB®
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
<h2>Table of Contents</h2>

              <p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro/index.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../replication/index.html">2. Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ddocs/index.html">3. Design Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../best-practices/index.html">4. Best Practices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administration Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/index.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">2. Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config/index.html">3. Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cluster/index.html">4. Cluster Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintenance/index.html">5. Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fauxton/index.html">6. Fauxton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../experimental.html">7. Experimental Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guides</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">1. API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../basics.html">1.1. API Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../server/index.html">1.2. Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/index.html">1.3. Databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../document/index.html">1.4. Documents</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">1.5. Design Documents</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="common.html">1.5.1. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="common.html#db-design-design-doc-attachment">1.5.2. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/attachment</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="common.html#db-design-design-doc-info">1.5.3. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_info</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="views.html">1.5.4. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_view/view-name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="search.html">1.5.5. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_search/index-name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="search.html#db-design-design-doc-search-info-index-name">1.5.6. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_search_info/index-name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="render.html">1.5.7. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_show/show-name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="render.html#db-design-design-doc-show-show-name-doc-id">1.5.8. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_show/show-name/doc-id</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="render.html#db-design-design-doc-list-list-name-view-name">1.5.9. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_list/list-name/view-name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="render.html#db-design-design-doc-list-list-name-other-ddoc-view-name">1.5.10. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_list/list-name/other-ddoc/view-name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="render.html#db-design-design-doc-update-update-name">1.5.11. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_update/update-name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="render.html#db-design-design-doc-update-update-name-doc-id">1.5.12. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_update/update-name/doc-id</span></code></a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">1.5.13. <code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_rewrite/path</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-a-stringified-function-for-rewrites">1.5.13.1. Using a stringified function for <code class="docutils literal notranslate"><span class="pre">rewrites</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-an-array-of-rules-for-rewrites">1.5.13.2. Using an array of rules for <code class="docutils literal notranslate"><span class="pre">rewrites</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../partitioned-dbs.html">1.6. Partitioned Databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../local.html">1.7. Local (non-replicating) Documents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../json-structure.html">2. JSON Structure Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../query-server/index.html">3. Query Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../partitioned-dbs/index.html">4. Partitioned Databases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../whatsnew/index.html">1. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cve/index.html">2. Security Issues / CVEs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cve/index.html#reporting-new-security-problems-with-apache-couchdb">3. Reporting New Security Problems with Apache CouchDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">4. License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">5. Contributing to this Documentation</a></li>
</ul>

<h2>Quick Reference Guides</h2>
<ul>
<li><a href="../../http-routingtable.html">API Quick Reference</a></li>
<li><a href="../../config-ref.html">Configuration Quick Reference</a></li>
</ul>


<h2>Local Links</h2>
<ul>
<li><a href="../">Fauxton</a></li>
</ul>


<h2>More Help</h2>
<ul>
<li><a href="https://couchdb.apache.org/">CouchDB Homepage</a></li>
<li><a href="https://couchdb.apache.org/#mailing-list">Mailing Lists</a></li>
<li><a href="https://couchdb.apache.org/#chat">Realtime Chat</a></li>
<li><a href="https://github.com/apache/couchdb/issues">Issue Tracker</a></li>
<li><a href="../../download.html">Download Docs</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Apache CouchDB®</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html"><span class="section-number">1. </span>API Reference</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">1.5. </span>Design Documents</a></li>
      <li class="breadcrumb-item active"><span class="section-number">1.5.13. </span><code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_rewrite/path</span></code></li>
  
    
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/api/ddoc/rewrites.rst.txt" rel="nofollow"> View page source</a>
      </li>
  

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="db-design-design-doc-rewrite-path">
<span id="api-ddoc-rewrite"></span><h1><span class="section-number">1.5.13. </span><code class="docutils literal notranslate"><span class="pre">/db/_design/design-doc/_rewrite/path</span></code><a class="headerlink" href="#db-design-design-doc-rewrite-path" title="Permalink to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Rewrites are deprecated in CouchDB 3.0, and will be removed in CouchDB 4.0.</p>
</div>
<dl class="http any">
<dt class="sig sig-object http" id="any--db-_design-ddoc-_rewrite-path">
<span class="sig-name descname"><span class="pre">ANY</span> </span><span class="sig-name descname"><span class="pre">/{db}/_design/{ddoc}/_rewrite/{path}</span></span><a class="headerlink" href="#any--db-_design-ddoc-_rewrite-path" title="Permalink to this definition">¶</a></dt>
<dd><p>Rewrites the specified path by rules defined in the specified design
document. The rewrite rules are defined by the <code class="docutils literal notranslate"><span class="pre">rewrites</span></code> field of the
design document. The <code class="docutils literal notranslate"><span class="pre">rewrites</span></code> field can either be a <em>string</em> containing
the a rewrite function or an <em>array</em> of rule definitions.</p>
</dd></dl>

<section id="using-a-stringified-function-for-rewrites">
<h2><span class="section-number">1.5.13.1. </span>Using a stringified function for <code class="docutils literal notranslate"><span class="pre">rewrites</span></code><a class="headerlink" href="#using-a-stringified-function-for-rewrites" title="Permalink to this heading">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0: </span>When the <code class="docutils literal notranslate"><span class="pre">rewrites</span></code> field is a stringified function, the query server is used
to pre-process and route requests.</p>
<p>The function takes a <a class="reference internal" href="../../json-structure.html#request2-object"><span class="std std-ref">Request2 object</span></a>.</p>
<p>The return value of the function will cause the server to rewrite the
request to a new location or immediately return a response.</p>
<p>To rewrite the request, return an object containing the following
properties:</p>
<ul class="simple">
<li><p><strong>path</strong> (<em>string</em>): Rewritten path.</p></li>
<li><p><strong>query</strong> (<em>array</em>): Rewritten query. If omitted, the original
query keys are used.</p></li>
<li><p><strong>headers</strong> (<em>object</em>): Rewritten headers. If omitted, the original
request headers are used.</p></li>
<li><p><strong>method</strong> (<em>string</em>): HTTP method of rewritten request (<code class="docutils literal notranslate"><span class="pre">&quot;GET&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;POST&quot;</span></code>, etc). If omitted, the original request method is used.</p></li>
<li><p><strong>body</strong> (<em>string</em>): Body for <code class="docutils literal notranslate"><span class="pre">&quot;POST&quot;</span></code>/<code class="docutils literal notranslate"><span class="pre">&quot;PUT&quot;</span></code> requests. If omitted,
the original request body is used.</p></li>
</ul>
<p>To immediately respond to the request, return an object containing the
following properties:</p>
<ul class="simple">
<li><p><strong>code</strong> (<em>number</em>): Returned HTTP status code (<code class="docutils literal notranslate"><span class="pre">200</span></code>, <code class="docutils literal notranslate"><span class="pre">404</span></code>, etc).</p></li>
<li><p><strong>body</strong> (<em>string</em>): Body of the response to user.</p></li>
</ul>
<p><strong>Example A</strong>. Restricting access.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="p">(</span><span class="nx">req2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req2</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">4</span><span class="p">),</span>
<span class="w">    </span><span class="nx">isWrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/^(put|post|delete)$/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">req2</span><span class="p">.</span><span class="nx">method</span><span class="p">),</span>
<span class="w">    </span><span class="nx">isFinance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req2</span><span class="p">.</span><span class="nx">userCtx</span><span class="p">.</span><span class="nx">roles</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;finance&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;finance&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">isWrite</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">isFinance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Deny writes to  DB &quot;finance&quot; for users</span>
<span class="w">    </span><span class="c1">// having no &quot;finance&quot; role</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="mf">403</span><span class="p">,</span>
<span class="w">      </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;forbidden&quot;</span><span class="p">.</span>
<span class="w">        </span><span class="nx">reason</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;You are not allowed to modify docs in this DB&quot;</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// Pass through all other requests</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;../../../&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Example B</strong>. Different replies for JSON and HTML requests.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="p">(</span><span class="nx">req2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req2</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">4</span><span class="p">),</span>
<span class="w">    </span><span class="nx">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">headers</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wantsJson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="p">.</span><span class="nx">Accept</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;application/json&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="nx">reply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">wantsJson</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Here we should prepare reply object</span>
<span class="w">    </span><span class="c1">// for plain HTML pages</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Pass through JSON requests</span>
<span class="w">    </span><span class="nx">reply</span><span class="p">.</span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../../../&quot;</span><span class="o">+</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">reply</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="using-an-array-of-rules-for-rewrites">
<h2><span class="section-number">1.5.13.2. </span>Using an array of rules for <code class="docutils literal notranslate"><span class="pre">rewrites</span></code><a class="headerlink" href="#using-an-array-of-rules-for-rewrites" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p>When the <code class="docutils literal notranslate"><span class="pre">rewrites</span></code> field is an array of rule objects, the server will
rewrite the request based on the first matching rule in the array.</p>
<p>Each rule in the array is an <em>object</em> with the following fields:</p>
<ul class="simple">
<li><p><strong>method</strong> (<em>string</em>): HTTP request method to bind the request method to
the rule. If omitted, uses <code class="docutils literal notranslate"><span class="pre">&quot;*&quot;</span></code>, which matches all methods.</p></li>
<li><p><strong>from</strong> (<em>string</em>): The pattern used to compare against the URL and
define dynamic variables.</p></li>
<li><p><strong>to</strong> (<em>string</em>): The path to rewrite the URL to. It can contain
variables depending on binding variables discovered during pattern
matching and query args (URL args and from the query member).</p></li>
<li><p><strong>query</strong> (<em>object</em>): Query args passed to the rewritten URL. They may
contain dynamic variables.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">to</span></code> and <code class="docutils literal notranslate"><span class="pre">from</span></code> paths may contains string patterns with leading
<code class="docutils literal notranslate"><span class="pre">:</span></code> or <code class="docutils literal notranslate"><span class="pre">*</span></code> characters to define dynamic variables in the match.</p>
<p>The first rule in the <code class="docutils literal notranslate"><span class="pre">rewrites</span></code> array that matches the incoming request
is used to define the rewrite. To match the incoming request, the
rule’s <code class="docutils literal notranslate"><span class="pre">method</span></code> must match the request’s HTTP method and the rule’s
<code class="docutils literal notranslate"><span class="pre">from</span></code> must match the request’s path using the following pattern matching
logic.</p>
<ul class="simple">
<li><p>The <em>from</em> pattern and URL are first split on <code class="docutils literal notranslate"><span class="pre">/</span></code> to get a list of
tokens. For example, if <em>from</em> field is <code class="docutils literal notranslate"><span class="pre">/somepath/:var/*</span></code> and the URL
is <code class="docutils literal notranslate"><span class="pre">/somepath/a/b/c</span></code>, the tokens are <code class="docutils literal notranslate"><span class="pre">somepath</span></code>, <code class="docutils literal notranslate"><span class="pre">:var</span></code>, and
<code class="docutils literal notranslate"><span class="pre">*</span></code> for the <em>from</em> pattern and <code class="docutils literal notranslate"><span class="pre">somepath</span></code>, <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, and
<code class="docutils literal notranslate"><span class="pre">c</span></code> for the URL.</p></li>
<li><p>Each token starting with <code class="docutils literal notranslate"><span class="pre">:</span></code> in the pattern will match the
corresponding token in the URL and define a new dynamic variable whose
name is the remaining string after the <code class="docutils literal notranslate"><span class="pre">:</span></code> and value is the token from
the URL. In this example, the <code class="docutils literal notranslate"><span class="pre">:var</span></code> token will match <code class="docutils literal notranslate"><span class="pre">b</span></code>
and set <code class="docutils literal notranslate"><span class="pre">var</span></code> = <code class="docutils literal notranslate"><span class="pre">a</span></code>.</p></li>
<li><p>The star token <code class="docutils literal notranslate"><span class="pre">*</span></code> in the pattern will match any number of tokens in
the URL and must be the last token in the pattern. It will define a
dynamic variable with the remaining tokens. In this example, the <code class="docutils literal notranslate"><span class="pre">*</span></code>
token will match the <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code> tokens and set <code class="docutils literal notranslate"><span class="pre">*</span></code> =
<code class="docutils literal notranslate"><span class="pre">b/c</span></code>.</p></li>
<li><p>The remaining tokens must match exactly for the pattern to be considered
a match. In this example, <code class="docutils literal notranslate"><span class="pre">somepath</span></code> in the pattern matches
<code class="docutils literal notranslate"><span class="pre">somepath</span></code> in the URL and all tokens in the URL have matched, causing
this rule to be a match.</p></li>
</ul>
<p>Once a rule is found, the request URL is rewritten using the <code class="docutils literal notranslate"><span class="pre">to</span></code> and
<code class="docutils literal notranslate"><span class="pre">query</span></code> fields. Dynamic variables are substituted into the <code class="docutils literal notranslate"><span class="pre">:</span></code> and
<code class="docutils literal notranslate"><span class="pre">*</span></code> variables in these fields to produce the final URL.</p>
<p>If no rule matches, a <a class="reference external" href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.5">404 Not Found</a> response is returned.</p>
<p>Examples:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Rule</p></th>
<th class="head"><p>URL</p></th>
<th class="head"><p>Rewrite to</p></th>
<th class="head"><p>Tokens</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><dl class="simple">
<dt>{“from”: “/a”,</dt><dd><p>“to”: “/some”}</p>
</dd>
</dl>
</td>
<td><p>/a</p></td>
<td><p>/some</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><dl class="simple">
<dt>{“from”: “/a/*”,</dt><dd><p>“to”: “/some/*}</p>
</dd>
</dl>
</td>
<td><p>/a/b/c</p></td>
<td><p>/some/b/c</p></td>
<td></td>
</tr>
<tr class="row-even"><td><dl class="simple">
<dt>{“from”: “/a/b”,</dt><dd><p>“to”: “/some”}</p>
</dd>
</dl>
</td>
<td><p>/a/b?k=v</p></td>
<td><p>/some?k=v</p></td>
<td><p>k=v</p></td>
</tr>
<tr class="row-odd"><td><dl class="simple">
<dt>{“from”: “/a/b”,</dt><dd><p>“to”: “/some/:var”}</p>
</dd>
</dl>
</td>
<td><p>/a/b</p></td>
<td><p>/some/b?var=b</p></td>
<td><p>var=b</p></td>
</tr>
<tr class="row-even"><td><dl class="simple">
<dt>{“from”: “/a/:foo/”,</dt><dd><p>“to”: “/some/:foo/”}</p>
</dd>
</dl>
</td>
<td><p>/a/b/c</p></td>
<td><p>/some/b/c?foo=b</p></td>
<td><p>foo=b</p></td>
</tr>
<tr class="row-odd"><td><dl class="simple">
<dt>{“from”: “/a/:foo”,</dt><dd><p>“to”: “/some”,
“query”: { “k”: “:foo” }}</p>
</dd>
</dl>
</td>
<td><p>/a/b</p></td>
<td><p>/some/?k=b&amp;foo=b</p></td>
<td><p>foo=b</p></td>
</tr>
<tr class="row-even"><td><dl class="simple">
<dt>{“from”: “/a”,</dt><dd><p>“to”: “/some/:foo”}</p>
</dd>
</dl>
</td>
<td><p>/a?foo=b</p></td>
<td><p>/some/?b&amp;foo=b</p></td>
<td><p>foo=b</p></td>
</tr>
</tbody>
</table>
<p>Request method, header, query parameters, request payload and response body
are dependent on the endpoint to which the URL will be rewritten.</p>
<dl class="field-list simple">
<dt class="field-odd">param db<span class="colon">:</span></dt>
<dd class="field-odd"><p>Database name</p>
</dd>
<dt class="field-even">param ddoc<span class="colon">:</span></dt>
<dd class="field-even"><p>Design document name</p>
</dd>
<dt class="field-odd">param path<span class="colon">:</span></dt>
<dd class="field-odd"><p>URL path to rewrite</p>
</dd>
</dl>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="render.html" class="btn btn-neutral float-left" title="1.5.7. /db/_design/design-doc/_show/show-name" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../partitioned-dbs.html" class="btn btn-neutral float-right" title="1.6. Partitioned Databases" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Apache Software Foundation. CouchDB® is a registered trademark of the Apache Software Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>