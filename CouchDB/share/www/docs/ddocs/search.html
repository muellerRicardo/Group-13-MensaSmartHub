<!--
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed
under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.
--><!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3.3. Search &mdash; Apache CouchDB® 3.3 Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/rtd_theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="https://docs.couchdb.org/en/stable/ddocs/search.html"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Best Practices" href="../best-practices/index.html" />
    <link rel="prev" title="3.2.5. Pagination Recipe" href="views/pagination.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Apache CouchDB®
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
<h2>Table of Contents</h2>

              <p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../replication/index.html">2. Replication</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">3. Design Documents</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ddocs.html">3.1. Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="views/index.html">3.2. Guide to Views</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.3. Search</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#index-functions">3.3.1. Index functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#index-guard-clauses">3.3.1.1. Index guard clauses</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#analyzers">3.3.2. Analyzers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#language-specific-analyzers">3.3.2.1. Language-specific analyzers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#per-field-analyzers">3.3.2.2. Per-field analyzers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stop-words">3.3.2.3. Stop words</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing-analyzer-tokenization">3.3.2.4. Testing analyzer tokenization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#queries">3.3.3. Queries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#query-parameters">3.3.3.1. Query Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#relevance">3.3.3.2. Relevance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#posting-search-queries">3.3.3.3. POSTing search queries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#query-syntax">3.3.4. Query syntax</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#faceting">3.3.4.1. Faceting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#counts">3.3.4.2. Counts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#drilldown">3.3.4.3. Drilldown</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ranges">3.3.4.4. Ranges</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#geographical-searches">3.3.5. Geographical searches</a></li>
<li class="toctree-l3"><a class="reference internal" href="#highlighting-search-terms">3.3.6. Highlighting search terms</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../best-practices/index.html">4. Best Practices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administration Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">2. Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">3. Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster/index.html">4. Cluster Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintenance/index.html">5. Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fauxton/index.html">6. Fauxton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../experimental.html">7. Experimental Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">1. API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../json-structure.html">2. JSON Structure Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../query-server/index.html">3. Query Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../partitioned-dbs/index.html">4. Partitioned Databases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew/index.html">1. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cve/index.html">2. Security Issues / CVEs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cve/index.html#reporting-new-security-problems-with-apache-couchdb">3. Reporting New Security Problems with Apache CouchDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">4. License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">5. Contributing to this Documentation</a></li>
</ul>

<h2>Quick Reference Guides</h2>
<ul>
<li><a href="../http-routingtable.html">API Quick Reference</a></li>
<li><a href="../config-ref.html">Configuration Quick Reference</a></li>
</ul>


<h2>Local Links</h2>
<ul>
<li><a href="../">Fauxton</a></li>
</ul>


<h2>More Help</h2>
<ul>
<li><a href="https://couchdb.apache.org/">CouchDB Homepage</a></li>
<li><a href="https://couchdb.apache.org/#mailing-list">Mailing Lists</a></li>
<li><a href="https://couchdb.apache.org/#chat">Realtime Chat</a></li>
<li><a href="https://github.com/apache/couchdb/issues">Issue Tracker</a></li>
<li><a href="../download.html">Download Docs</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache CouchDB®</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">3. </span>Design Documents</a></li>
      <li class="breadcrumb-item active"><span class="section-number">3.3. </span>Search</li>
  
    
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ddocs/search.rst.txt" rel="nofollow"> View page source</a>
      </li>
  

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="search">
<span id="ddoc-search"></span><h1><span class="section-number">3.3. </span>Search<a class="headerlink" href="#search" title="Permalink to this heading">¶</a></h1>
<p>Search indexes enable you to query a database by using the
<a class="reference external" href="http://lucene.apache.org/core/4_3_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#Overview">Lucene Query Parser Syntax.</a>
A search index uses one, or multiple, fields from your documents. You can use a search
index to run queries, find documents based on the content they contain, or work with
groups, facets, or geographical searches.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Search cannot function unless it has a functioning, cluster-connected
Clouseau instance. See <a class="reference internal" href="../install/search.html#install-search"><span class="std std-ref">Search Plugin Installation</span></a>
for details.</p>
</div>
<p>To create a search index, you add a JavaScript function to a design document in the
database. An index builds after processing one search request or after the server detects
a document update. The <code class="docutils literal notranslate"><span class="pre">index</span></code> function takes the following parameters:</p>
<ol class="arabic simple">
<li><p>Field name - The name of the field you want to use when you query the index.
If you set this parameter to <code class="docutils literal notranslate"><span class="pre">default</span></code>, then this field is queried if no field is
specified in the query syntax.</p></li>
<li><p>Data that you want to index, for example, <code class="docutils literal notranslate"><span class="pre">doc.address.country</span></code>.</p></li>
<li><p>(Optional) The third parameter includes the following fields: <code class="docutils literal notranslate"><span class="pre">boost</span></code>, <code class="docutils literal notranslate"><span class="pre">facet</span></code>,
<code class="docutils literal notranslate"><span class="pre">index</span></code>, and <code class="docutils literal notranslate"><span class="pre">store</span></code>. These fields are described in more detail later.</p></li>
</ol>
<p>By default, a search index response returns 25 rows. The number of rows that is returned
can be changed by using the <code class="docutils literal notranslate"><span class="pre">limit</span></code> parameter. Each response includes a <code class="docutils literal notranslate"><span class="pre">bookmark</span></code>
field. You can include the value of the <code class="docutils literal notranslate"><span class="pre">bookmark</span></code> field in later queries to look
through the responses.</p>
<p><em>Example design document that defines a search index:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;_design/search_example&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;indexes&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;animals&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;function(doc){ ... }&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A search index will inherit the partitioning type from the <code class="docutils literal notranslate"><span class="pre">options.partitioned</span></code> field
of the design document that contains it.</p>
<section id="index-functions">
<h2><span class="section-number">3.3.1. </span>Index functions<a class="headerlink" href="#index-functions" title="Permalink to this heading">¶</a></h2>
<p>Attempting to index by using a data field that does not exist fails. To avoid
this problem, use the appropriate
<a class="reference internal" href="#ddoc-search-index-guard-clauses"><span class="std std-ref">guard clause</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your indexing functions operate in a memory-constrained environment
where the document itself forms a part of the memory that is used
in that environment. Your code’s stack and document must fit inside this
memory. In other words, a document must be loaded in order to be indexed.
Documents are limited to a maximum size of 64 MB.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Within a search index, do not index the same field name with more than one data
type. If the same field name is indexed with different data types in the same search
index function, you might get an error when querying the search index that says the
field “was indexed without position data.” For example, do not include both of these
lines in the same search index function, as they index the <code class="docutils literal notranslate"><span class="pre">myfield</span></code> field as two
different data types: a string <code class="docutils literal notranslate"><span class="pre">&quot;this</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">string&quot;</span></code> and a number <code class="docutils literal notranslate"><span class="pre">123</span></code>.</p>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;myfield&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;this is a string&quot;</span><span class="p">);</span>
<span class="nx">index</span><span class="p">(</span><span class="s2">&quot;myfield&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">123</span><span class="p">);</span>
</pre></div>
</div>
<p>The function that is contained in the index field is a JavaScript function
that is called for each document in the database.
The function takes the document as a parameter,
extracts some data from it, and then calls the function that is defined
in the <code class="docutils literal notranslate"><span class="pre">index</span></code> field to index that data.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">index</span></code> function takes three parameters, where the third parameter is optional.</p>
<ol class="arabic">
<li><p>The first parameter is the name of the field you intend to use when querying the index,
and which is specified in the Lucene syntax portion of subsequent queries.
An example appears in the following query:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">query</span><span class="o">=</span><span class="nx">color</span><span class="o">:</span><span class="nx">red</span>
</pre></div>
</div>
<p>The Lucene field name <code class="docutils literal notranslate"><span class="pre">color</span></code> is the first parameter of the <code class="docutils literal notranslate"><span class="pre">index</span></code> function.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">query</span></code> parameter can be abbreviated to <code class="docutils literal notranslate"><span class="pre">q</span></code>,
so another way of writing the query is as follows:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">q</span><span class="o">=</span><span class="nx">color</span><span class="o">:</span><span class="nx">red</span>
</pre></div>
</div>
<p>If the special value <code class="docutils literal notranslate"><span class="pre">&quot;default&quot;</span></code> is used when you define the name,
you do not have to specify a field name at query time.
The effect is that the query can be simplified:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">query</span><span class="o">=</span><span class="nx">red</span>
</pre></div>
</div>
</li>
<li><p>The second parameter is the data to be indexed. Keep the following information
in mind when you index your data:</p>
<ul class="simple">
<li><p>This data must be only a string, number, or boolean. Other types will cause
an error to be thrown by the index function call.</p></li>
<li><p>If an error is thrown when running your function, for this reason or others,
the document will not be added to that search index.</p></li>
</ul>
</li>
<li><p>The third, optional, parameter is a JavaScript object with the following fields:</p>
<p><em>Index function (optional parameter)</em></p>
<ul class="simple">
<li><p><strong>boost</strong> - A number that specifies the relevance in search results. Content that is
indexed with a boost value greater than 1 is more relevant than content that is
indexed without a boost value. Content with a boost value less than one is not so
relevant. Value is a positive floating point number. Default is 1 (no boosting).</p></li>
<li><p><strong>facet</strong> - Creates a faceted index. See <a class="reference internal" href="#ddoc-search-faceting"><span class="std std-ref">Faceting</span></a>.
Values are <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><strong>index</strong> - Whether the data is indexed, and if so, how. If set to <code class="docutils literal notranslate"><span class="pre">false</span></code>, the
data cannot be used for searches, but can still be retrieved from the index if
<code class="docutils literal notranslate"><span class="pre">store</span></code> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>. See <a class="reference internal" href="#ddoc-search-analyzers"><span class="std std-ref">Analyzers</span></a>.
Values are <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>. Default is <code class="docutils literal notranslate"><span class="pre">true</span></code></p></li>
<li><p><strong>store</strong> - If <code class="docutils literal notranslate"><span class="pre">true</span></code>, the value is returned in the search result; otherwise,
the value is not returned. Values are <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you do not set the <code class="docutils literal notranslate"><span class="pre">store</span></code> parameter,
the index data results for the document are not returned in response to a query.</p>
</div>
</li>
</ol>
<p><em>Example search index function:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;min_length&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">diet</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;diet&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">diet</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">latin_name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;latin_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">latin_name</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="kd">class</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="kd">class</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="index-guard-clauses">
<span id="ddoc-search-index-guard-clauses"></span><h3><span class="section-number">3.3.1.1. </span>Index guard clauses<a class="headerlink" href="#index-guard-clauses" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">index</span></code> function requires the name of the data field to index as the second
parameter. However, if that data field does not exist for the document, an error occurs.
The solution is to use an appropriate ‘guard clause’ that checks if the field exists, and
contains the expected type of data, <em>before</em> any attempt to create the corresponding
index.</p>
<p><em>Example of failing to check whether the index data field exists:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;min_length&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You might use the JavaScript <code class="docutils literal notranslate"><span class="pre">typeof</span></code> function to implement the guard clause test. If
the field exists <em>and</em> has the expected type, the correct type name is returned, so the
guard clause test succeeds and it is safe to use the index function. If the field does
<em>not</em> exist, you would not get back the expected type of the field, therefore you would
not attempt to index the field.</p>
<p>JavaScript considers a result to be false if one of the following values is tested:</p>
<ul class="simple">
<li><p>‘undefined’</p></li>
<li><p>null</p></li>
<li><p>The number +0</p></li>
<li><p>The number -0</p></li>
<li><p>NaN (not a number)</p></li>
<li><p>“” (the empty string)</p></li>
</ul>
<p><em>Using a guard clause to check whether the required data field exists, and holds a number,
before an attempt to index:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;min_length&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Use a generic guard clause test to ensure that the type of the candidate data field is
defined.</p>
<p><em>Example of a ‘generic’ guard clause:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">)</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// The field exists, and does have a type, so we can proceed to index using it.</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="analyzers">
<span id="ddoc-search-analyzers"></span><h2><span class="section-number">3.3.2. </span>Analyzers<a class="headerlink" href="#analyzers" title="Permalink to this heading">¶</a></h2>
<p>Analyzers are settings that define how to recognize terms within text. Analyzers can be
helpful if you need to
<a class="reference internal" href="#ddoc-search-language-specific-analyzers"><span class="std std-ref">index multiple languages</span></a>.</p>
<p>Here’s the list of generic analyzers, and their descriptions, that are supported by
search:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">classic</span></code> - The standard Lucene analyzer, circa release 3.1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">email</span></code> - Like the <code class="docutils literal notranslate"><span class="pre">standard</span></code> analyzer, but tries harder to
match an email address as a complete token.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyword</span></code> - Input is not tokenized at all.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">simple</span></code> - Divides text at non-letters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">standard</span></code> - The default analyzer. It implements the Word Break
rules from the <a class="reference external" href="http://www.unicode.org/reports/tr29/">Unicode Text Segmentation algorithm</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">whitespace</span></code> - Divides text at white space boundaries.</p></li>
</ul>
<p><em>Example analyzer document:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;_design/analyzer_example&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;indexes&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;INDEX_NAME&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;function (doc) { ... }&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;analyzer&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$ANALYZER_NAME&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="language-specific-analyzers">
<span id="ddoc-search-language-specific-analyzers"></span><h3><span class="section-number">3.3.2.1. </span>Language-specific analyzers<a class="headerlink" href="#language-specific-analyzers" title="Permalink to this heading">¶</a></h3>
<p>These analyzers omit common words in the specific language,
and many also <a class="reference external" href="http://en.wikipedia.org/wiki/Stemming">remove prefixes and suffixes</a>.
The name of the language is also the name of the analyzer. See
<a class="reference external" href="https://lucene.apache.org/core/4_6_1/core/org/apache/lucene/analysis/package-summary.html">package org.apache.lucene.analysis</a>
for more information.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Language</p></th>
<th class="head"><p>Analyzer</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">arabic</span></code></p></td>
<td><p>org.apache.lucene.analysis.ar.ArabicAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">armenian</span></code></p></td>
<td><p>org.apache.lucene.analysis.hy.ArmenianAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">basque</span></code></p></td>
<td><p>org.apache.lucene.analysis.eu.BasqueAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">bulgarian</span></code></p></td>
<td><p>org.apache.lucene.analysis.bg.BulgarianAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">brazilian</span></code></p></td>
<td><p>org.apache.lucene.analysis.br.BrazilianAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">catalan</span></code></p></td>
<td><p>org.apache.lucene.analysis.ca.CatalanAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cjk</span></code></p></td>
<td><p>org.apache.lucene.analysis.cjk.CJKAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">chinese</span></code></p></td>
<td><p>org.apache.lucene.analysis.cn.smart.SmartChineseAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">czech</span></code></p></td>
<td><p>org.apache.lucene.analysis.cz.CzechAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">danish</span></code></p></td>
<td><p>org.apache.lucene.analysis.da.DanishAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dutch</span></code></p></td>
<td><p>org.apache.lucene.analysis.nl.DutchAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">english</span></code></p></td>
<td><p>org.apache.lucene.analysis.en.EnglishAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">finnish</span></code></p></td>
<td><p>org.apache.lucene.analysis.fi.FinnishAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">french</span></code></p></td>
<td><p>org.apache.lucene.analysis.fr.FrenchAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">german</span></code></p></td>
<td><p>org.apache.lucene.analysis.de.GermanAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">greek</span></code></p></td>
<td><p>org.apache.lucene.analysis.el.GreekAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">galician</span></code></p></td>
<td><p>org.apache.lucene.analysis.gl.GalicianAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hindi</span></code></p></td>
<td><p>org.apache.lucene.analysis.hi.HindiAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hungarian</span></code></p></td>
<td><p>org.apache.lucene.analysis.hu.HungarianAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">indonesian</span></code></p></td>
<td><p>org.apache.lucene.analysis.id.IndonesianAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">irish</span></code></p></td>
<td><p>org.apache.lucene.analysis.ga.IrishAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">italian</span></code></p></td>
<td><p>org.apache.lucene.analysis.it.ItalianAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">japanese</span></code></p></td>
<td><p>org.apache.lucene.analysis.ja.JapaneseAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">japanese</span></code></p></td>
<td><p>org.apache.lucene.analysis.ja.JapaneseTokenizer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">latvian</span></code></p></td>
<td><p>org.apache.lucene.analysis.lv.LatvianAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">norwegian</span></code></p></td>
<td><p>org.apache.lucene.analysis.no.NorwegianAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">persian</span></code></p></td>
<td><p>org.apache.lucene.analysis.fa.PersianAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">polish</span></code></p></td>
<td><p>org.apache.lucene.analysis.pl.PolishAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">portuguese</span></code></p></td>
<td><p>org.apache.lucene.analysis.pt.PortugueseAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">romanian</span></code></p></td>
<td><p>org.apache.lucene.analysis.ro.RomanianAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">russian</span></code></p></td>
<td><p>org.apache.lucene.analysis.ru.RussianAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">spanish</span></code></p></td>
<td><p>org.apache.lucene.analysis.es.SpanishAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">swedish</span></code></p></td>
<td><p>org.apache.lucene.analysis.sv.SwedishAnalyzer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">thai</span></code></p></td>
<td><p>org.apache.lucene.analysis.th.ThaiAnalyzer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">turkish</span></code></p></td>
<td><p>org.apache.lucene.analysis.tr.TurkishAnalyzer</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">japanese</span></code> analyzer, org.apache.lucene.analysis.ja.JapaneseTokenizer,
includes DEFAULT_MODE and defaultStopTags.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Language-specific analyzers are optimized for the specified language. You cannot
combine a generic analyzer with a language-specific analyzer. Instead, you might use a
<a class="reference internal" href="#ddoc-search-per-field-analyzers"><span class="std std-ref">per field analyzer</span></a> to select different
analyzers for different fields within the documents.</p>
</div>
</section>
<section id="per-field-analyzers">
<span id="ddoc-search-per-field-analyzers"></span><h3><span class="section-number">3.3.2.2. </span>Per-field analyzers<a class="headerlink" href="#per-field-analyzers" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">perfield</span></code> analyzer configures multiple analyzers for different fields.</p>
<p><em>Example of defining different analyzers for different fields:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;_design/analyzer_example&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;indexes&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;INDEX_NAME&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;analyzer&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;perfield&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;default&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;english&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="s2">&quot;spanish&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;spanish&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;german&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;german&quot;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;function (doc) { ... }&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="stop-words">
<h3><span class="section-number">3.3.2.3. </span>Stop words<a class="headerlink" href="#stop-words" title="Permalink to this heading">¶</a></h3>
<p>Stop words are words that do not get indexed. You define them within a design document by
turning the analyzer string into an object.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">keyword</span></code>, <code class="docutils literal notranslate"><span class="pre">simple</span></code>, and <code class="docutils literal notranslate"><span class="pre">whitespace</span></code> analyzers do not support stop words.</p>
</div>
<p>The default stop words for the <code class="docutils literal notranslate"><span class="pre">standard</span></code> analyzer are included below:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;an&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;and&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;are&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;as&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;at&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;be&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;but&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;by&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;for&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;if&quot;</span><span class="p">,</span>
<span class="s2">&quot;in&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;into&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;is&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;it&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;no&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;not&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;of&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;on&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;or&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;such&quot;</span><span class="p">,</span>
<span class="s2">&quot;that&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;the&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;their&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;then&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;there&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;these&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;they&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;this&quot;</span><span class="p">,</span>
<span class="s2">&quot;to&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;was&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;will&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;with&quot;</span>
</pre></div>
</div>
<p><em>Example of defining non-indexed (‘stop’) words:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;_design/stop_words_example&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;indexes&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;INDEX_NAME&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;analyzer&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;portuguese&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;stopwords&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;baz&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;function (doc) { ... }&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="testing-analyzer-tokenization">
<h3><span class="section-number">3.3.2.4. </span>Testing analyzer tokenization<a class="headerlink" href="#testing-analyzer-tokenization" title="Permalink to this heading">¶</a></h3>
<p>You can test the results of analyzer tokenization by posting sample data to the
<code class="docutils literal notranslate"><span class="pre">_search_analyze</span></code> endpoint.</p>
<p><em>Example of using HTTP to test the keyword analyzer:</em></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/_search_analyze</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">{&quot;analyzer&quot;</span><span class="o">:</span><span class="l">&quot;keyword&quot;, &quot;text&quot;:&quot;ablanks@renovations.com&quot;}</span>
</pre></div>
</div>
<p><em>Example of using the command line to test the keyword analyzer:</em></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span><span class="s1">&#39;https://$HOST:5984/_search_analyze&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span>
<span class="w">    </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;analyzer&quot;:&quot;keyword&quot;, &quot;text&quot;:&quot;ablanks@renovations.com&quot;}&#39;</span>
</pre></div>
</div>
<p><em>Result of testing the keyword analyzer:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;tokens&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;ablanks@renovations.com&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example of using HTTP to test the standard analyzer:</em></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/_search_analyze</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">{&quot;analyzer&quot;</span><span class="o">:</span><span class="l">&quot;standard&quot;, &quot;text&quot;:&quot;ablanks@renovations.com&quot;}</span>
</pre></div>
</div>
<p><em>Example of using the command line to test the standard analyzer:</em></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span><span class="s1">&#39;https://$HOST:5984/_search_analyze&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span>
<span class="w">    </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;analyzer&quot;:&quot;standard&quot;, &quot;text&quot;:&quot;ablanks@renovations.com&quot;}&#39;</span>
</pre></div>
</div>
<p><em>Result of testing the standard analyzer:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;tokens&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;ablanks&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;renovations.com&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="queries">
<h2><span class="section-number">3.3.3. </span>Queries<a class="headerlink" href="#queries" title="Permalink to this heading">¶</a></h2>
<p>After you create a search index, you can query it.</p>
<ul class="simple">
<li><p>Issue a partition query using:
<code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/$DATABASE/_partition/$PARTITION_KEY/_design/$DDOC/_search/$INDEX_NAME</span></code></p></li>
<li><p>Issue a global query using:
<code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/$DATABASE/_design/$DDOC/_search/$INDEX_NAME</span></code></p></li>
</ul>
<p>Specify your search by using the <code class="docutils literal notranslate"><span class="pre">query</span></code> parameter.</p>
<p><em>Example of using HTTP to query a partitioned index:</em></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/$DATABASE/_partition/$PARTITION_KEY/_design/$DDOC/_search/$INDEX_NAME?include_docs=true&amp;query=&quot;*:*&quot;&amp;limit=1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>
</div>
<p><em>Example of using HTTP to query a global index:</em></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/$DATABASE/_design/$DDOC/_search/$INDEX_NAME?include_docs=true&amp;query=&quot;*:*&quot;&amp;limit=1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>
</div>
<p><em>Example of using the command line to query a partitioned index:</em></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>https://<span class="nv">$HOST</span>:5984/<span class="nv">$DATABASE</span>/_partition/<span class="nv">$PARTITION_KEY</span>/_design/<span class="nv">$DDOC</span>/
_search/<span class="nv">$INDEX_NAME</span>?include_docs<span class="o">=</span>true<span class="se">\&amp;</span><span class="nv">query</span><span class="o">=</span><span class="s2">&quot;*:*&quot;</span><span class="se">\&amp;</span><span class="nv">limit</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</pre></div>
</div>
<p><em>Example of using the command line to query a global index:</em></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>https://<span class="nv">$HOST</span>:5984/<span class="nv">$DATABASE</span>/_design/<span class="nv">$DDOC</span>/_search/<span class="nv">$INDEX_NAME</span>?
<span class="nv">include_docs</span><span class="o">=</span>true<span class="se">\&amp;</span><span class="nv">query</span><span class="o">=</span><span class="s2">&quot;*:*&quot;</span><span class="se">\&amp;</span><span class="nv">limit</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</pre></div>
</div>
<section id="query-parameters">
<span id="ddoc-search-query-parameters"></span><h3><span class="section-number">3.3.3.1. </span>Query Parameters<a class="headerlink" href="#query-parameters" title="Permalink to this heading">¶</a></h3>
<p>A full list of query parameters can be found in the
<a class="reference internal" href="../api/ddoc/search.html#api-ddoc-search"><span class="std std-ref">API Reference</span></a>.</p>
<p>You must enable <a class="reference internal" href="#ddoc-search-faceting"><span class="std std-ref">faceting</span></a> before you can use the
following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">counts</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">drilldown</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ranges</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do not combine the <code class="docutils literal notranslate"><span class="pre">bookmark</span></code> and <code class="docutils literal notranslate"><span class="pre">stale</span></code> options. These options
constrain the choice of shard replicas to use for the response. When used
together, the options might cause problems when contact is attempted
with replicas that are slow or not available.</p>
</div>
</section>
<section id="relevance">
<h3><span class="section-number">3.3.3.2. </span>Relevance<a class="headerlink" href="#relevance" title="Permalink to this heading">¶</a></h3>
<p>When more than one result might be returned, it is possible for them to be sorted. By
default, the sorting order is determined by ‘relevance’.</p>
<p>Relevance is measured according to
<a class="reference external" href="https://lucene.apache.org/core/3_6_0/scoring.html">Apache Lucene Scoring</a>.
As an example, if you search a simple database for the word <code class="docutils literal notranslate"><span class="pre">example</span></code>, two documents
might contain the word. If one document mentions the word <code class="docutils literal notranslate"><span class="pre">example</span></code> 10 times, but the
second document mentions it only twice, then the first document is considered to be more
‘relevant’.</p>
<p>If you do not provide a <code class="docutils literal notranslate"><span class="pre">sort</span></code> parameter, relevance is used by default. The highest
scoring matches are returned first.</p>
<p>If you provide a <code class="docutils literal notranslate"><span class="pre">sort</span></code> parameter, then matches are returned in that order, ignoring
relevance.</p>
<p>If you want to use a <code class="docutils literal notranslate"><span class="pre">sort</span></code> parameter, and also include ordering by relevance in your
search results, use the special fields <code class="docutils literal notranslate"><span class="pre">-&lt;score&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;score&gt;</span></code> within the <code class="docutils literal notranslate"><span class="pre">sort</span></code>
parameter.</p>
</section>
<section id="posting-search-queries">
<h3><span class="section-number">3.3.3.3. </span>POSTing search queries<a class="headerlink" href="#posting-search-queries" title="Permalink to this heading">¶</a></h3>
<p>Instead of using the <code class="docutils literal notranslate"><span class="pre">GET</span></code> HTTP method, you can also use <code class="docutils literal notranslate"><span class="pre">POST</span></code>. The main advantage of
<code class="docutils literal notranslate"><span class="pre">POST</span></code> queries is that they can have a request body, so you can specify the request as a
JSON object. Each parameter in the query string of a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request corresponds to a
field in the JSON object in the request body.</p>
<p><em>Example of using HTTP to POST a search request:</em></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/db/_design/ddoc/_search/searchname</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>
</div>
<p><em>Example of using the command line to POST a search request:</em></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span><span class="s1">&#39;https://$HOST:5984/db/_design/ddoc/_search/searchname&#39;</span><span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>-d<span class="w"> </span>@search.json
</pre></div>
</div>
<p><em>Example JSON document that contains a search request:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;q&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;index:my query&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;sort&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">3</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="query-syntax">
<h2><span class="section-number">3.3.4. </span>Query syntax<a class="headerlink" href="#query-syntax" title="Permalink to this heading">¶</a></h2>
<p>The CouchDB search query syntax is based on the
<a class="reference external" href="http://lucene.apache.org/core/4_3_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#Overview">Lucene syntax.</a>
Search queries take the form of <code class="docutils literal notranslate"><span class="pre">name:value</span></code> unless the name is omitted, in which case
they use the default field, as demonstrated in the following examples:</p>
<p><em>Example search query expressions:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Birds</span>
<span class="kd">class</span><span class="o">:</span><span class="nx">bird</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Animals that begin with the letter &quot;l&quot;
l*
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Carnivorous birds
class:bird AND diet:carnivore
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Herbivores that start with letter &quot;l&quot;
l* AND diet:herbivore
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Medium-sized herbivores
min_length:[1 TO 3] AND diet:herbivore
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Herbivores that are 2m long or less
diet:herbivore AND min_length:[-Infinity TO 2]
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Mammals that are at least 1.5m long
class:mammal AND min_length:[1.5 TO Infinity]
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Find &quot;Meles meles&quot;
latin_name:&quot;Meles meles&quot;
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Mammals who are herbivore or carnivore
diet:(herbivore OR omnivore) AND class:mammal
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Return all results
*:*
</pre></div>
</div>
<p>Queries over multiple fields can be logically combined, and groups and fields can be
further grouped. The available logical operators are case-sensitive and are <code class="docutils literal notranslate"><span class="pre">AND</span></code>,
<code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">OR</span></code>, <code class="docutils literal notranslate"><span class="pre">NOT</span></code> and <code class="docutils literal notranslate"><span class="pre">-</span></code>. Range queries can run over strings or numbers.</p>
<p>If you want a fuzzy search, you can run a query with <code class="docutils literal notranslate"><span class="pre">~</span></code> to find terms like the search
term. For instance, <code class="docutils literal notranslate"><span class="pre">look~</span></code> finds the terms <code class="docutils literal notranslate"><span class="pre">book</span></code> and <code class="docutils literal notranslate"><span class="pre">took</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the lower and upper bounds of a range query are both strings that
contain only numeric digits, the bounds are treated as numbers not as
strings. For example, if you search by using the query
<code class="docutils literal notranslate"><span class="pre">mod_date:[&quot;20170101&quot;</span> <span class="pre">TO</span> <span class="pre">&quot;20171231&quot;]</span></code>, the results include documents
for which <code class="docutils literal notranslate"><span class="pre">mod_date</span></code> is between the numeric values 20170101 and
20171231, not between the strings “20170101” and “20171231”.</p>
</div>
<p>You can alter the importance of a search term by adding <code class="docutils literal notranslate"><span class="pre">^</span></code> and a positive number. This
alteration makes matches containing the term more or less relevant, proportional to the
power of the boost value. The default value is 1, which means no increase or decrease in
the strength of the match. A decimal value of 0 - 1 reduces importance. making the match
strength weaker. A value greater than one increases importance, making the match strength
stronger.</p>
<p>Wildcard searches are supported, for both single (<code class="docutils literal notranslate"><span class="pre">?</span></code>) and multiple (<code class="docutils literal notranslate"><span class="pre">*</span></code>) character
searches. For example, <code class="docutils literal notranslate"><span class="pre">dat?</span></code> would match <code class="docutils literal notranslate"><span class="pre">date</span></code> and <code class="docutils literal notranslate"><span class="pre">data</span></code>, whereas <code class="docutils literal notranslate"><span class="pre">dat*</span></code> would
match <code class="docutils literal notranslate"><span class="pre">date</span></code>, <code class="docutils literal notranslate"><span class="pre">data</span></code>, <code class="docutils literal notranslate"><span class="pre">database</span></code>, and <code class="docutils literal notranslate"><span class="pre">dates</span></code>. Wildcards must come after the
search term.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">*:*</span></code> to return all results.</p>
<p>If the search query does <em>not</em> specify the <code class="docutils literal notranslate"><span class="pre">&quot;group_field&quot;</span></code> argument, the response
contains a bookmark. If this bookmark is later provided as a URL parameter, the response
skips the rows that were seen already, making it quick and easy to get the next set of
results.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The response never includes a bookmark if the <code class="docutils literal notranslate"><span class="pre">&quot;group_field&quot;</span></code>
parameter is included in the search query.
See <a class="reference internal" href="../api/ddoc/search.html#api-ddoc-search"><span class="std std-ref">group_field parameter</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">group_field</span></code>, <code class="docutils literal notranslate"><span class="pre">group_limit</span></code>, and <code class="docutils literal notranslate"><span class="pre">group_sort</span></code> options
are only available when making global queries.</p>
</div>
<p>The following characters require escaping if you want to search on them:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>+<span class="w"> </span>-<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>!<span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">]</span><span class="w"> </span>^<span class="w"> </span><span class="s2">&quot; ~ * ? : \ /</span>
</pre></div>
</div>
<p>To escape one of these characters, use a preceding backslash character (<code class="docutils literal notranslate"><span class="pre">\</span></code>).</p>
<p>The response to a search query contains an <code class="docutils literal notranslate"><span class="pre">order</span></code> field for each of the results. The
<code class="docutils literal notranslate"><span class="pre">order</span></code> field is an array where the first element is the field or fields that are
specified in the <code class="docutils literal notranslate"><span class="pre">sort</span></code> parameter. See the
<a class="reference internal" href="../api/ddoc/search.html#api-ddoc-search"><span class="std std-ref">sort parameter</span></a>. If no <code class="docutils literal notranslate"><span class="pre">sort</span></code> parameter is included
in the query, then the <code class="docutils literal notranslate"><span class="pre">order</span></code> field contains the <a class="reference external" href="https://lucene.apache.org/core/3_6_0/scoring.html">Lucene relevance score</a>. If you use the ‘sort by distance’
feature as described in <a class="reference internal" href="#ddoc-search-geographical-searches"><span class="std std-ref">geographical searches</span></a>,
then the first element is the distance from a point. The distance is measured by using
either kilometers or miles.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The second element in the order array can be ignored.
It is used for troubleshooting purposes only.</p>
</div>
<section id="faceting">
<span id="ddoc-search-faceting"></span><h3><span class="section-number">3.3.4.1. </span>Faceting<a class="headerlink" href="#faceting" title="Permalink to this heading">¶</a></h3>
<p>CouchDB Search also supports faceted searching, enabling discovery of aggregate
information about matches quickly and easily. You can match all documents by using the
special <code class="docutils literal notranslate"><span class="pre">?q=*:*</span></code> query syntax, and use the returned facets to refine your query. To
indicate that a field must be indexed for faceted queries, set <code class="docutils literal notranslate"><span class="pre">{&quot;facet&quot;:</span> <span class="pre">true}</span></code> in its
options.</p>
<p><em>Example of search query, specifying that faceted search is enabled:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;facet&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">price</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;facet&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To use facets, all the documents in the index must include all the fields that have
faceting enabled. If your documents do not include all the fields, you receive a
<code class="docutils literal notranslate"><span class="pre">bad_request</span></code> error with the following reason, “The <code class="docutils literal notranslate"><span class="pre">field_name</span></code> does not exist.” If
each document does not contain all the fields for facets, create separate indexes for each
field. If you do not create separate indexes for each field, you must include only
documents that contain all the fields. Verify that the fields exist in each document by
using a single <code class="docutils literal notranslate"><span class="pre">if</span></code> statement.</p>
<p><em>Example if statement to verify that the required fields exist in each document:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">town</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;town&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">town</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">facet</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">facet</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">   </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="counts">
<h3><span class="section-number">3.3.4.2. </span>Counts<a class="headerlink" href="#counts" title="Permalink to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">counts</span></code> option is only available when making global queries.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">counts</span></code> facet syntax takes a list of fields, and returns the number of query
results for each unique value of each named field.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">count</span></code> operation works only if the indexed values are strings.
The indexed values cannot be mixed types. For example,
if 100 strings are indexed, and one number,
then the index cannot be used for <code class="docutils literal notranslate"><span class="pre">count</span></code> operations.
You can check the type by using the <code class="docutils literal notranslate"><span class="pre">typeof</span></code> operator, and convert it
by using the <code class="docutils literal notranslate"><span class="pre">parseInt</span></code>,
<code class="docutils literal notranslate"><span class="pre">parseFloat</span></code>, or <code class="docutils literal notranslate"><span class="pre">.toString()</span></code> functions.</p>
</div>
<p><em>Example of a query using the counts facet syntax:</em></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>?q=*:*&amp;counts=[&quot;type&quot;]
</pre></div>
</div>
<p><em>Example response after using of the counts facet syntax:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total_rows&quot;</span><span class="o">:</span><span class="mf">100000</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;bookmark&quot;</span><span class="o">:</span><span class="s2">&quot;g...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;rows&quot;</span><span class="o">:</span><span class="p">[...],</span>
<span class="w">    </span><span class="s2">&quot;counts&quot;</span><span class="o">:</span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;sofa&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;chair&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;lamp&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">97</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="drilldown">
<h3><span class="section-number">3.3.4.3. </span>Drilldown<a class="headerlink" href="#drilldown" title="Permalink to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> option is only available when making global queries.</p>
</div>
<p>You can restrict results to documents with a dimension equal to the specified label.
Restrict the results by adding <code class="docutils literal notranslate"><span class="pre">drilldown=[&quot;dimension&quot;,&quot;label&quot;]</span></code> to a search query. You
can include multiple <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> parameters to restrict results along multiple
dimensions.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/things/_design/inventory/_search/fruits?q=*:*&amp;drilldown=[&quot;state&quot;,&quot;old&quot;]&amp;drilldown=[&quot;item&quot;,&quot;apple&quot;]&amp;include_docs=true</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>
</div>
<p>For better language interoperability, you can achieve the same by supplying a list of lists:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/things/_design/inventory/_search/fruits?q=*:*&amp;drilldown=[[&quot;state&quot;,&quot;old&quot;],[&quot;item&quot;,&quot;apple&quot;]]&amp;include_docs=true</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>
</div>
<p>You can also supply a list of lists for <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> in bodies of POST requests.</p>
<p>Note that, multiple values for a single key in a <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> means an
<code class="docutils literal notranslate"><span class="pre">OR</span></code> relation between them and there is an <code class="docutils literal notranslate"><span class="pre">AND</span></code> relation between multiple keys.</p>
<p>Using a <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> parameter is similar to using <code class="docutils literal notranslate"><span class="pre">key:value</span></code> in the <code class="docutils literal notranslate"><span class="pre">q</span></code> parameter,
but the <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> parameter returns values that the analyzer might skip.</p>
<p>For example, if the analyzer did not index a stop word like <code class="docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code>, using <code class="docutils literal notranslate"><span class="pre">drilldown</span></code>
returns it when you specify <code class="docutils literal notranslate"><span class="pre">drilldown=[&quot;key&quot;,&quot;a&quot;]</span></code>.</p>
</section>
<section id="ranges">
<h3><span class="section-number">3.3.4.4. </span>Ranges<a class="headerlink" href="#ranges" title="Permalink to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ranges</span></code> option is only available when making global queries.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">range</span></code> facet syntax reuses the standard Lucene syntax for ranges to return counts
of results that fit into each specified category. Inclusive range queries are denoted by
brackets (<code class="docutils literal notranslate"><span class="pre">[</span></code>, <code class="docutils literal notranslate"><span class="pre">]</span></code>). Exclusive range queries are denoted by curly brackets (<code class="docutils literal notranslate"><span class="pre">{</span></code>,
<code class="docutils literal notranslate"><span class="pre">}</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">range</span></code> operation works only if the indexed values are numbers. The indexed
values cannot be mixed types. For example, if 100 strings are indexed, and one number,
then the index cannot be used for <code class="docutils literal notranslate"><span class="pre">range</span></code> operations. You can check the type by
using the <code class="docutils literal notranslate"><span class="pre">typeof</span></code> operator, and convert it by using the <code class="docutils literal notranslate"><span class="pre">parseInt</span></code>,
<code class="docutils literal notranslate"><span class="pre">parseFloat</span></code>, or <code class="docutils literal notranslate"><span class="pre">.toString()</span></code> functions.</p>
</div>
<p><em>Example of a request that uses faceted search for matching ranges:</em></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>?q=*:*&amp;ranges={&quot;price&quot;:{&quot;cheap&quot;:&quot;[0 TO 100]&quot;,&quot;expensive&quot;:&quot;{100 TO Infinity}&quot;}}
</pre></div>
</div>
<p><em>Example results after a ranges check on a faceted search:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total_rows&quot;</span><span class="o">:</span><span class="mf">100000</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;bookmark&quot;</span><span class="o">:</span><span class="s2">&quot;g...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;rows&quot;</span><span class="o">:</span><span class="p">[...],</span>
<span class="w">    </span><span class="s2">&quot;ranges&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;expensive&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">278682</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;cheap&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">257023</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="geographical-searches">
<span id="ddoc-search-geographical-searches"></span><h2><span class="section-number">3.3.5. </span>Geographical searches<a class="headerlink" href="#geographical-searches" title="Permalink to this heading">¶</a></h2>
<p>In addition to searching by the content of textual fields, you can also sort your results
by their distance from a geographic coordinate using Lucene’s built-in geospatial
capabilities.</p>
<p>To sort your results in this way, you must index two numeric fields, representing the
longitude and latitude.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also sort your results by their distance from a geographic coordinate
using Lucene’s built-in geospatial capabilities.</p>
</div>
<p>You can then query by using the special <code class="docutils literal notranslate"><span class="pre">&lt;distance...&gt;</span></code> sort field, which takes five
parameters:</p>
<ul class="simple">
<li><p>Longitude field name: The name of your longitude field (<code class="docutils literal notranslate"><span class="pre">mylon</span></code> in the example).</p></li>
<li><p>Latitude field name: The name of your latitude field (<code class="docutils literal notranslate"><span class="pre">mylat</span></code> in the example).</p></li>
<li><p>Longitude of origin: The longitude of the place you want to sort by distance from.</p></li>
<li><p>Latitude of origin: The latitude of the place you want to sort by distance from.</p></li>
<li><p>Units: The units to use: <code class="docutils literal notranslate"><span class="pre">km</span></code> for kilometers or <code class="docutils literal notranslate"><span class="pre">mi</span></code> for miles.
The distance is returned in the order field.</p></li>
</ul>
<p>You can combine sorting by distance with any other search query, such as range searches on
the latitude and longitude, or queries that involve non-geographical information.</p>
<p>That way, you can search in a bounding box, and narrow down the search with extra
criteria.</p>
<p><em>Example geographical data:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Aberdeen, Scotland&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;lat&quot;</span><span class="o">:</span><span class="mf">57.15</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;lon&quot;</span><span class="o">:-</span><span class="mf">2.15</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;city&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example of a design document that contains a search index for the geographic data:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;city&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">index</span><span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;store&#39;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">        </span><span class="nx">index</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">lat</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;store&#39;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">        </span><span class="nx">index</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">lon</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;store&#39;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>An example of using HTTP for a query that sorts cities in the northern hemisphere by
their distance to New York:</em></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/examples/_design/cities-designdoc/_search/cities?q=lat:[0+TO+90]&amp;sort=&quot;&lt;distance,lon,lat,-74.0059,40.7127,km&gt;&quot;</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>
</div>
<p><em>An example of using the command line for a query that sorts cities in the northern
hemisphere by their distance to New York:</em></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span><span class="s1">&#39;https://$HOST:5984/examples/_design/cities-designdoc/_search/cities?q=lat:[0+TO+90]&amp;sort=&quot;&lt;distance,lon,lat,-74.0059,40.7127,km&gt;&quot;&#39;</span>
</pre></div>
</div>
<p><em>Example (abbreviated) response, containing a list of northern hemisphere
cities sorted by distance to New York:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total_rows&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">205</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;bookmark&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;g1A...XIU&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;rows&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;city180&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;order&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="mf">8.530665755719783</span><span class="p">,</span>
<span class="w">                </span><span class="mf">18</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;city&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;New York, N.Y.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;lat&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">40.78333333333333</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;lon&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">73.96666666666667</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;city177&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;order&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="mf">13.756343205985946</span><span class="p">,</span>
<span class="w">                </span><span class="mf">17</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;city&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Newark, N.J.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;lat&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">40.733333333333334</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;lon&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">74.16666666666667</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;city178&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;order&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="mf">113.53603438866077</span><span class="p">,</span>
<span class="w">                </span><span class="mf">26</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;city&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;New Haven, Conn.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;lat&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">41.31666666666667</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;lon&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">72.91666666666667</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="highlighting-search-terms">
<h2><span class="section-number">3.3.6. </span>Highlighting search terms<a class="headerlink" href="#highlighting-search-terms" title="Permalink to this heading">¶</a></h2>
<p>Sometimes it is useful to get the context in which a search term was mentioned so that you
can display more emphasized results to a user.</p>
<p>To get more emphasized results, add the <code class="docutils literal notranslate"><span class="pre">highlight_fields</span></code> parameter to the search
query. Specify the field names for which you would like excerpts, with the highlighted
search term returned.</p>
<p>By default, the search term is placed in <code class="docutils literal notranslate"><span class="pre">&lt;em&gt;</span></code> tags to highlight it, but the highlight
can be overridden by using the <code class="docutils literal notranslate"><span class="pre">highlights_pre_tag</span></code> and <code class="docutils literal notranslate"><span class="pre">highlights_post_tag</span></code>
parameters.</p>
<p>The length of the fragments is 100 characters by default. A different length can be
requested with the <code class="docutils literal notranslate"><span class="pre">highlights_size</span></code> parameter.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">highlights_number</span></code> parameter controls the number of fragments that are returned,
and defaults to 1.</p>
<p>In the response, a <code class="docutils literal notranslate"><span class="pre">highlights</span></code> field is added, with one subfield per field name.</p>
<p>For each field, you receive an array of fragments with the search term highlighted.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For highlighting to work, store the field in the index by
using the <code class="docutils literal notranslate"><span class="pre">store:</span> <span class="pre">true</span></code> option.</p>
</div>
<p><em>Example of using HTTP to search with highlighting enabled:</em></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/movies/_design/searches/_search/movies?q=movie_name:Azazel&amp;highlight_fields=[&quot;movie_name&quot;]&amp;highlight_pre_tag=&quot;**&quot;&amp;highlight_post_tag=&quot;**&quot;&amp;highlights_size=30&amp;highlights_number=2</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">...</span>
</pre></div>
</div>
<p><em>Example of using the command line to search with
highlighting enabled:</em></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span><span class="s2">&quot;https://</span><span class="nv">$HOST</span><span class="s2">:5984/movies/_design/searches/_search/movies?q=movie_name:Azazel&amp;highlight_fields=\[\&quot;movie_name\&quot;\]&amp;highlight_pre_tag=\&quot;**\&quot;&amp;highlight_post_tag=\&quot;**\&quot;&amp;highlights_size=30&amp;highlights_number=2</span>
</pre></div>
</div>
<p><em>Example of highlighted search results:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;highlights&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;movie_name&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot; on the Azazel Orient Express&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot; Azazel manuals, you&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="views/pagination.html" class="btn btn-neutral float-left" title="3.2.5. Pagination Recipe" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../best-practices/index.html" class="btn btn-neutral float-right" title="4. Best Practices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Apache Software Foundation. CouchDB® is a registered trademark of the Apache Software Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>